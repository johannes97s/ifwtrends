#Damit kann unter Angabe von
g_index <- function(keywords = NA,
categories = 0,
end,
start = as.Date("2004-01-01"),
roll = F){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date("2004-01-01"), as.Date(end), by = "month")
if (!roll){
dat = tibble(date = NULL, keyword = NULL, category = NULL, value = NULL)
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
stopifnot(str_c("Keine Daten für Kategorie ", cat) = nrow(temp) == 0)
mutate(date = as_date(date)) %>%
select(date = date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
}
return(ts_prcomp(dat))
#return(pivot_wider(ts_prcomp(dat), names_from = id, values_from = value))
}
stopifnot(str_c("Keine Daten für Kategorie ", cat) = nrow(4) == 0)
str_c("Keine Daten für Kategorie ", 330)
str_c("Keine Daten für Kategorie ", "330")
stopifnot(str_c("Keine Daten für Kategorie ", cat), nrow(4) == 0)
stopifnot(str_c("Keine Daten für Kategorie ", 330), nrow(4) == 0)
stopifnot(str_c("Keine Daten für Kategorie ", 330) = nrow(4) == 0)
stopifnot("Keine Daten für Kategorie ", nrow(4) == 0)
stopifnot("Keine Daten für Kategorie " =nrow(4) == 0)
stopifnot("Keine Daten für Kategorie " =nrow() == 0)
stopifnot("Keine Daten für Kategorie " =nrow(NULL) == 0)
stopifnot("Keine Daten für Kategorie " =nrow(NULL) != 0)
stopifnot("Keine Daten für Kategorie " =nrow(4) != 0)
nrow(4)
NROW(4)
NROW(0)
stopifnot("Keine Daten für Kategorie " = NROW(4) != 0)
stopifnot("Keine Daten für Kategorie " = NROW(4) == 0)
stopifnot(str_c("Keine Daten für Kategorie ", 330) = NROW(4) == 0)
stopifnot(as.character(str_c("Keine Daten für Kategorie ", 330)) = NROW(4) == 0)
paste("Keine Daten für Kategorie ", 300)
stopifnot(paste("Keine Daten für Kategorie ", 330) = NROW(4) == 0)
stopifnot("Keine Daten für Kategorie " = NROW(4) == 0)
############################
#Damit kann unter Angabe von
g_index <- function(keywords = NA,
categories = 0,
end,
start = as.Date("2004-01-01"),
roll = F){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date("2004-01-01"), as.Date(end), by = "month")
if (!roll){
dat = tibble(date = NULL, keyword = NULL, category = NULL, value = NULL)
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
mutate(date = as_date(date)) %>%
select(date = date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
}
return(ts_prcomp(dat))
#return(pivot_wider(ts_prcomp(dat), names_from = id, values_from = value))
}
g_index(categories = 330, end = "2021-01-01")
g_index(categories = c(651,330), end = "2021-01-01")
g_index(categories = c(651), end = "2021-01-01")
dt_utc <- ymd_hms("2010-08-03 00:50:50")
dt_utc
c(as_date(dt_utc), as.Date(dt_utc))
class(c(as_date(dt_utc), as.Date(dt_utc)))
date_floor(dt_utc)
floor_date(dt_utc)
floor_date(dt_utc, "day")
############################
#Damit kann unter Angabe von
g_index <- function(keywords = NA,
categories = 0,
end,
start = as.Date("2004-01-01"),
roll = F){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date("2004-01-01"), as.Date(end), by = "month")
if (!roll){
dat = tibble(date = NULL, keyword = NULL, category = NULL, value = NULL)
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
mutate(date = floor_date(date, "day")) %>%
select(date = date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
}
return(ts_prcomp(dat))
#return(pivot_wider(ts_prcomp(dat), names_from = id, values_from = value))
}
g_index(categories = c(651), end = "2021-01-01")
gtrends(category = 651, geo = "DE", time = "all")$interest_over_time
as_tibble(gtrends(category = 651, geo = "DE", time = "all")$interest_over_time)
as_tibble(gtrends(category = 651, geo = "DE", time = "all")$interest_over_time) %>%
mutate(date = floor_date(date, "day"))
as_tibble(gtrends(category = 651, geo = "DE", time = "all")$interest_over_time) %>%
mutate(date = as_date(date))
############################
#Damit kann unter Angabe von
g_index <- function(keywords = NA,
categories = 0,
end,
start = as.Date("2004-01-01"),
roll = F){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date("2004-01-01"), as.Date(end), by = "month")
if (!roll){
dat = tibble(date = NULL, keyword = NULL, category = NULL, value = NULL)
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
mutate(date = as_date(date)) %>%
select(date = date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
}
return(ts_prcomp(dat))
#return(pivot_wider(ts_prcomp(dat), names_from = id, values_from = value))
}
g_index(categories = c(651), end = "2021-01-01")
############################
#Damit kann unter Angabe von
g_index <- function(keywords = NA,
categories = 0,
end,
start = as.Date("2004-01-01"),
roll = F){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date("2004-01-01"), as.Date(end), by = "month")
if (!roll){
dat = tibble(date = NULL, key = NULL, value = NULL)
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
mutate(date = as_date(date)) %>%
select(date = date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
}
return(ts_prcomp(dat))
#return(pivot_wider(ts_prcomp(dat), names_from = id, values_from = value))
}
g_index(categories = c(651), end = "2021-01-01")
############################
#Damit kann unter Angabe von
g_index <- function(keywords = NA,
categories = 0,
end,
start = as.Date("2004-01-01"),
roll = F){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date("2004-01-01"), as.Date(end), by = "month")
if (!roll){
dat = tibble(date = NULL, key = NULL, value = NULL)
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
mutate(date = as_date(date)) %>%
select(date = date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
}
return(ts_prcomp(dat))
#return(pivot_wider(ts_prcomp(dat), names_from = id, values_from = value))
}
dates = seq.Date(as.Date("2004-01-01"), as.Date("2021-01-01"), by = "month")
as_tibble(gtrends(category = 651, geo = "DE", time = "all")$interest_over_time) %>%
mutate(date = as_date(date))
as_tibble(gtrends(category = c(651), geo = "DE", time = "all")$interest_over_time) %>%
mutate(date = as_date(date))
############################
#Damit kann unter Angabe von
g_index <- function(keywords = NA,
categories = 0,
end,
start = as.Date("2004-01-01"),
roll = F){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date("2004-01-01"), as.Date(end), by = "month")
if (!roll){
dat = tibble(date = NULL, key = NULL, value = NULL)
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
temp %>%
mutate(date = as_date(date)) %>%
select(date = date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
}
return(ts_prcomp(dat))
#return(pivot_wider(ts_prcomp(dat), names_from = id, values_from = value))
}
g_index(categories = c(651), end = "2021-01-01")
g_index(categories = c(330, 651), end = "2021-01-01")
g_index(categories = c(3, 330, 651), end = "2021-01-01")
g_index(categories = c(3, 651), end = "2021-01-01")
############################
#Damit kann unter Angabe von
g_index <- function(keywords = NA,
categories = 0,
end,
start = as.Date("2004-01-01"),
roll = F){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date("2004-01-01"), as.Date(end), by = "month")
if (!roll){
dat = tibble(date = NULL, key = NULL, value = NULL)
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
temp %>%
mutate(date = as_date(date)) %>%
select(date = date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
}
return(pivot_wider(ts_prcomp(dat), names_from = id, values_from = value))
}
g_index(categories = c(3, 651), end = "2021-01-01")
g_index(categories = c(330, 651), end = "2021-01-01")
g_index(categories = c(3,4, 651), end = "2021-01-01")
g_index(keywords = c("prüfung", "Abitur", "Abiturnote", "NC"), end = "2021-01-01")
pca <- function(series, start = "2014-01-01", end = max(series$time)){
period <- seq.Date(as.Date(start), as.Date(end), by = "month")
dates <- seq.Date(as.Date("2006-01-01"), as.Date(end), by = "month")
pc <- tibble(id = "PC1", time = dates)
n <- length(dates)#L?nge der ganzen Reihe
for(i in period){ #L?nge der Periode oft
d <- as.Date(i, origin = "1970-01-01")
series %>%
filter(time <= d) -> temp
pc_temp <- ts_pick(ts_prcomp(temp), "PC1")
pc <- bind_cols(pc, tibble(n = c(pc_temp$value, rep(NA, (n-length(pc_temp$value))))))
}
return(pc)
}
ts_gtrends(
keyword = kw,
geo = "US",
time = "all"
) %>%
filter(time >= as.Date("2006-01-01") & time <= as.Date("2021-06-01")) -> dat
kw = c("Wirtschaftskrise", "Kurzarbeit", "arbeitslos", "Insolvenz")
ts_gtrends(
keyword = kw,
geo = "US",
time = "all"
) %>%
filter(time >= as.Date("2006-01-01") & time <= as.Date("2021-06-01")) -> dat
pca <- function(series, start = "2014-01-01", end = max(series$time)){
period <- seq.Date(as.Date(start), as.Date(end), by = "month")
dates <- seq.Date(as.Date("2006-01-01"), as.Date(end), by = "month")
pc <- tibble(id = "PC1", time = dates)
n <- length(dates)#L?nge der ganzen Reihe
for(i in period){ #L?nge der Periode oft
d <- as.Date(i, origin = "1970-01-01")
series %>%
filter(time <= d) -> temp
pc_temp <- ts_pick(ts_prcomp(temp), "PC1")
pc <- bind_cols(pc, tibble(n = c(pc_temp$value, rep(NA, (n-length(pc_temp$value))))))
}
return(pc)
}
tb <- pca(dat, start = "2014-01-01", end = "2021-06-01")
tb
dates <- seq.Date(as.Date("2014-01-01"), as.Date("2021-06-01"), by = "month")
names = c("id", "time",str_c("to ", dates ))
names(tb) <- names
tb
roll <- function(keywords, categories, start = as.Date("2014-01-01"), end = as.Date("2021-01-01"))
############################
#Damit kann unter Angabe von
pca <- function(keywords = NA,
categories = 0,
start = as.Date("2004-01-01"),
end,
n = max(length(kewyords), length(categories))){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date("2004-01-01"), as.Date(end), by = "month")
dat = tibble(date = NULL, key = NULL, value = NULL)
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
temp %>%
mutate(date = as_date(date)) %>%
select(date = date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
if (roll){
}
return(pivot_wider(ts_prcomp(dat), names_from = id, values_from = value)[1:n])
}
g_index(categories = c(331,651,3))
g_index(categories = c(331,651,3), end  = "2021-01-01")
g_index(categories = c(1,651,3), end  = "2021-01-01")
g_index(categories = c(751,651,3), end  = "2021-01-01")
tibble(c("a","b", "d") = "d")
t = tibble
t
t = tibble()
t
nrow(t) <- 4
names(t) = c("a", "b", "c")
t = tibble(NULL, NULL)
t
source('~/ifwtrends/R/Trends.R')
pca(categories = c(751,651,3), end  = "2021-01-01")
############################
#Damit kann unter Angabe von
pca <- function(keywords = NA,
categories = 0,
start = as.Date("2004-01-01"),
end,
components = max(length(kewyords), length(categories))){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date("2004-01-01"), as.Date(end), by = "month")
dat = tibble(date = NULL, key = NULL, value = NULL)
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
temp %>%
mutate(date = as_date(date)) %>%
select(date = date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
if (roll){
}
return(pivot_wider(ts_prcomp(dat), names_from = id, values_from = value)[1:n])
}
pca(categories = c(751,651,3), end  = "2021-01-01")
############################
#Damit kann unter Angabe von
pca <- function(keywords = NA,
categories = 0,
start = as.Date("2004-01-01"),
end,
components = max(length(kewyords), length(categories))){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date("2004-01-01"), as.Date(end), by = "month")
dat = tibble(date = NULL, key = NULL, value = NULL)
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
temp %>%
mutate(date = as_date(date)) %>%
select(date = date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
return(pivot_wider(ts_prcomp(dat), names_from = id, values_from = value)[1:n])
}
pca(categories = c(751,651,3), end  = "2021-01-01")
############################
#Damit kann unter Angabe von
pca <- function(keywords = NA,
categories = 0,
start = as.Date("2004-01-01"),
end,
components = max(length(kewyords), length(categories))){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date("2004-01-01"), as.Date(end), by = "month")
dat = tibble(date = NULL, key = NULL, value = NULL)
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
temp %>%
mutate(date = as_date(date)) %>%
select(date = date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
return(pivot_wider(ts_prcomp(dat), names_from = id, values_from = value)[1:components])
}
pca(categories = c(751,651,3), end  = "2021-01-01")
############################
#Damit kann unter Angabe von
pca <- function(keywords = NA,
categories = 0,
start = as.Date("2004-01-01"),
end,
components = max(length(keywords), length(categories))){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date("2004-01-01"), as.Date(end), by = "month")
dat = tibble(date = NULL, key = NULL, value = NULL)
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
temp %>%
mutate(date = as_date(date)) %>%
select(date = date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
return(pivot_wider(ts_prcomp(dat), names_from = id, values_from = value)[1:components])
}
pca(categories = c(751,651,3), end  = "2021-01-01")
select(pca(categories = c(751,651,3), end  = "2021-01-01"), -time)
t
t = tibble(a = c(4,5,6), b = "")
t = tibble(a = c(4,5,6), b = "d")
t
t %>% names() <- c("h". "i")
t %>% names() <- c("h", "i")
t %>% names(.) <- c("h", "i")
t %>% (names(.) <- c("h", "i"))
t %>% (names() <- c("h", "i"))
use_r("other_frequencies.R")
library(tidyverse)
library(gtrendsR)
library(trendecon)
library(tsbox)
library(openxlsx)
library(corrr)
library(lubridate)
proc_keyword_init("headset", "CH")
proc_keyword_init("arbeitslos", "DE")
