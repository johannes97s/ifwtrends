for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
if ("keyword" %in% names(temp)) select(temp, -category)
temp %>%
mutate(date = as_date(date)) %>%
select(date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}}
print(dat)
#'
#'
pca <- function(keywords = NA,
categories = 0,
start = "2006-01-01",
end = Sys.Date(),
components = max(length(keywords), length(categories))){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date(start), as.Date(end), by = "month")
dat = tibble()
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
if ("keyword" %in% names(temp)) select(temp, -category)
print(temp)
temp %>%
mutate(date = as_date(date)) %>%
select(date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
print(temp)
dat <- bind_rows(dat, temp)
}
}
pc <- pivot_wider(ts_prcomp(dat), names_from = id, values_from = value)[1:(components+1)]
dat <- pivot_wider(dat, names_from = )
}
pca(keywords)
#'
#'
pca <- function(keywords = NA,
categories = 0,
start = "2006-01-01",
end = Sys.Date(),
components = max(length(keywords), length(categories))){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date(start), as.Date(end), by = "month")
dat = tibble()
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
if ("keyword" %in% names(temp)) select(temp, -category)
print(temp)
temp %>%
mutate(date = as_date(date)) %>%
select(date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
print(temp)
dat <- bind_rows(dat, temp)
}
}
print(dat)
pc <- pivot_wider(ts_prcomp(dat), names_from = id, values_from = value)[1:(components+1)]
dat <- pivot_wider(dat, names_from = )
}
pca(keywords)
keywords
keywords = c("ikea", "saturn")
pca(keywords)
#'
#'
pca <- function(keywords = NA,
categories = 0,
start = "2006-01-01",
end = Sys.Date(),
components = max(length(keywords), length(categories))){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date(start), as.Date(end), by = "month")
dat = tibble()
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
if ("keyword" %in% names(temp)) select(temp, -category)
temp %>%
mutate(date = as_date(date)) %>%
select(date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
print(dat)
pc <- pivot_wider(ts_prcomp(dat), names_from = id, values_from = value)[1:(components+1)]
dat <- pivot_wider(dat, names_from = )
}
pca(keywords)
keywords = keywords
categories = 651
start = "2006-01-01"
end = Sys.Date()
components = max(length(keywords), length(categories))
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date(start), as.Date(end), by = "month")
dat = tibble()
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
if ("keyword" %in% names(temp)) select(temp, -category)
temp %>%
mutate(date = as_date(date)) %>%
select(date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}}
dat
keywords = keywords
categories = 0
start = "2006-01-01"
end = Sys.Date()
components = max(length(keywords), length(categories))
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date(start), as.Date(end), by = "month")
dat = tibble()
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
if ("keyword" %in% names(temp)) select(temp, -category)
temp %>%
mutate(date = as_date(date)) %>%
select(date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}}
dat
keywords = NA
categories = 651
start = "2006-01-01"
end = Sys.Date()
components = max(length(keywords), length(categories))
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date(start), as.Date(end), by = "month")
dat = tibble()
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time)  -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
if ("keyword" %in% names(temp)) select(temp, -category)
temp %>%
mutate(date = as_date(date)) %>%
select(date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}}
dat
temp
"keyword" %in% names(temp)
"key" %in% names(temp)
as_tibble(gtrends(
keyword = keywords[1],
category = 0,
geo = "DE",
time = "all")$interest_over_time)
keywords[1]
as_tibble(gtrends(
keyword = "ikea",
category = 0,
geo = "DE",
time = "all")$interest_over_time)
t <- as_tibble(gtrends(
keyword = "ikea",
category = 0,
geo = "DE",
time = "all")$interest_over_time)
#'
#'
pca <- function(keywords = NA,
categories = 0,
start = "2006-01-01",
end = Sys.Date(),
components = max(length(keywords), length(categories))){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date(start), as.Date(end), by = "month")
dat = tibble()
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time) -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
if ("keyword" %in% names(temp)) temp <- select(temp, -category)
temp %>%
mutate(date = as_date(date)) %>%
select(date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
print(dat)
pc <- pivot_wider(ts_prcomp(dat), names_from = id, values_from = value)[1:(components+1)]
dat <- pivot_wider(dat, names_from = )
}
pca(c("ikea", "saturn"))
#'
#'
pca <- function(keywords = NA,
categories = 0,
start = "2006-01-01",
end = Sys.Date(),
components = max(length(keywords), length(categories))){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date(start), as.Date(end), by = "month")
dat = tibble()
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time) -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
if ("keyword" %in% names(temp)) temp <- select(temp, -category)
temp %>%
mutate(date = as_date(date)) %>%
select(date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
print(dat)
pc <- pivot_wider(ts_prcomp(dat), names_from = id, values_from = value)[1:(components+1)]
dat <- pivot_wider(dat, names_from = key, values_from = value)
bind_cols(pc, dat)
}
pca(c("ikea", "saturn"))
#'
#'
pca <- function(keywords = NA,
categories = 0,
start = "2006-01-01",
end = Sys.Date(),
components = max(length(keywords), length(categories))){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date(start), as.Date(end), by = "month")
dat = tibble()
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time) -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
if ("keyword" %in% names(temp)) temp <- select(temp, -category)
temp %>%
mutate(date = as_date(date)) %>%
select(date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
pc <- pivot_wider(ts_prcomp(dat), names_from = id, values_from = value)[1:(components+1)]
dat <- pivot_wider(dat, -time, names_from = key, values_from = value)
bind_cols(pc, dat)
}
pca(c("ikea", "saturn"))
#'
#'
pca <- function(keywords = NA,
categories = 0,
start = "2006-01-01",
end = Sys.Date(),
components = max(length(keywords), length(categories))){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date(start), as.Date(end), by = "month")
dat = tibble()
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time) -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
if ("keyword" %in% names(temp)) temp <- select(temp, -category)
temp %>%
mutate(date = as_date(date)) %>%
select(date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
pc <- pivot_wider(ts_prcomp(dat), names_from = id, values_from = value)[1:(components+1)]
dat <- pivot_wider(dat, -date, names_from = key, values_from = value)
bind_cols(pc, dat)
}
pca(c("ikea", "saturn"))
#'
#'
pca <- function(keywords = NA,
categories = 0,
start = "2006-01-01",
end = Sys.Date(),
components = max(length(keywords), length(categories))){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date(start), as.Date(end), by = "month")
dat = tibble()
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time) -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
if ("keyword" %in% names(temp)) temp <- select(temp, -category)
temp %>%
mutate(date = as_date(date)) %>%
select(date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
pc <- pivot_wider(ts_prcomp(dat), names_from = id, values_from = value)[1:(components+1)]
dat <- dat %>%
select(-date) %>%
pivot_wider(names_from = key, values_from = value)
bind_cols(pc, dat)
}
pca(c("ikea", "saturn"))
#'
#'
pca <- function(keywords = NA,
categories = 0,
start = "2006-01-01",
end = Sys.Date(),
components = max(length(keywords), length(categories))){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date(start), as.Date(end), by = "month")
dat = tibble()
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time) -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
if ("keyword" %in% names(temp)) temp <- select(temp, -category)
temp %>%
mutate(date = as_date(date)) %>%
select(date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
pc <- pivot_wider(ts_prcomp(dat), names_from = id, values_from = value)[1:(components+1)]
dat <- dat %>%
select(-date) %>%
pivot_wider(names_from = key, values_from = value)
print(dat)
bind_cols(pc, dat)
}
pca(c("ikea", "saturn"))
#'
#'
pca <- function(keywords = NA,
categories = 0,
start = "2006-01-01",
end = Sys.Date(),
components = max(length(keywords), length(categories))){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date(start), as.Date(end), by = "month")
dat = tibble()
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time) -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
if ("keyword" %in% names(temp)) temp <- select(temp, -category)
temp %>%
mutate(date = as_date(date)) %>%
select(date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
pc <- pivot_wider(ts_prcomp(dat), names_from = id, values_from = value)[1:(components+1)]
dat <- dat %>%
pivot_wider(names_from = key, values_from = value) %>%
select(-date) %>%
bind_cols(pc, dat)
}
pca(c("ikea", "saturn"))
pca(c("ikea", "saturn"))
#'
#'
pca <- function(keywords = NA,
categories = 0,
start = "2006-01-01",
end = Sys.Date(),
components = max(length(keywords), length(categories))){
stopifnot("Nur keywords oder categories darf angegeben werden" = is.na(keywords) | categories == 0)
dates = seq.Date(as.Date(start), as.Date(end), by = "month")
dat = tibble()
for (kw in keywords){
for (cat in categories){
as_tibble(gtrends(
keyword = kw,
category = cat,
geo = "DE",
time = "all")$interest_over_time) -> temp
if (NROW(temp) == 0) stop(str_c("Keine Daten für Kategorie ", cat))
if ("keyword" %in% names(temp)) temp <- select(temp, -category)
temp %>%
mutate(date = as_date(date)) %>%
select(date, key = any_of(c("keyword", "category")), value = hits) %>%
filter(date %in% dates) -> temp
dat <- bind_rows(dat, temp)
}
}
pc <- pivot_wider(ts_prcomp(dat), names_from = id, values_from = value)[1:(components+1)]
dat <-select(pivot_wider(dat, names_from = key, values_from = value), -date)
bind_cols(pc, dat)
}
roll <- function(keywords = NA,
categories = 0,
start_series = "2006-01-01",
start_period = "2014-01-01",
end = Sys.Date(),
components = max(length(keywords), length(categories))){
period <-  seq.Date(as.Date(start_period), as.Date(end), by = "month")
dates <- seq.Date(as.Date("2006-01-01"), as.Date(end), by = "month")
pc <- tibble(date = dates)
n <- length(dates)#L?nge der ganzen Reihe
for (i in period){
d <- as.Date(i, origin = "1970-01-01")
pca(keywords = keywords,
categories = categories,
start = start_series,
end = d,
components = components) %>%
select(-time) -> temp
rest <- matrix(NA, n - nrow(temp), components)
colnames(rest) <- str_c("PC", 1:components)
rest <- as_tibble(rest)
temp <- bind_rows(temp, rest)
names(temp) <- str_c(names(temp), " to ", d)
pc <- bind_cols(pc, temp)
}
pc
}
pca(c("ikea", "saturn"))
keywords = c("abitur", "abiturnote", "NC")
start_series = as.Date("2004-01-01")
period <-  seq.Date(as.Date("2005-01-01"), as.Date("2006-01-01"), by = "month")
n = 212
d <- as.Date("2015-01-01")
pca(keywords = keywords, start = start_series, end = d) %>%
select(-time) -> temp
# pca(keywords = c("abitur", "abiturnote", "NC"), end = "2021-01-01")
tb <- roll(keywords = c("abitur", "abiturnote", "NC"),
start_period = "2007-01-01",
end = "2008-01-01")
View(tb)
devtools::install("~/IFW/ifwtrends")
devtools::install("~/Documents/IFW/ifwtrends")
.Last.error.trace
devtools::install(~/Documents/IFW/ifwtrends)
devtools::install("~/Documents/IFW/ifwtrends")
devtools::install("~/Documents/IFW/ifwtrends")
f <- devtools::build("ifwtrends")
system(paste0("R CMD INSTALL --build ", f))
load_all()
devtools::load_all()
devtools::install("~/Documents/IFW/ifwtrends")
