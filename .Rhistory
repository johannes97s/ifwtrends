print(sereis)
View(sereis)
cat_paper <- as_tibble(read.csv("Kategorien_Woloszko.csv", head = F))
names(cat_paper) = "name"
cat_paper <- as_tibble(read.csv("Kategorien_Woloszko.csv", head = F))
names(cat_paper) = "name"
cat<- as_tibble(categories)
cat_paper %>%
left_join(cat, by = "name") %>%
unique() -> cat_paper
print(cat_paper, n = 100)
as_tibble(gtrends(geo = "DE", time = "all", category = c(47))$interest_over_time)
series <- tibble(date = seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month"))
for (i in cat_paper$id[1:20]){
#print(i)
series <- bind_cols(series, i = gtrends(geo = "DE", time = "all", category = i)$interest_over_time$hits)
}
for (i in cat_paper$id[1:10]){
#print(i)
series <- bind_cols(series, i = gtrends(geo = "DE", time = "all", category = i)$interest_over_time$hits)
}
series <- tibble(date = seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month"))
for (i in cat_paper$id[1:10]){
#print(i)
series <- bind_cols(series, i = gtrends(geo = "DE", time = "all", category = i)$interest_over_time$hits)
}
names(series) <- c("date", cat_paper$name[2:10])
series <- pivot_longer(series, cols = -date, names_to = "id", values_to = "hits")
print(series, n = 100)
series <- tibble(date = seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month"))
for (i in cat_paper$id[1:10]){
#print(i)
series <- bind_cols(series, i = gtrends(geo = "DE", time = "all", category = i)$interest_over_time$hits)
}
names(series) <- c("date", cat_paper$name[1:10])
series <- tibble(date = seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month"))
for (i in cat_paper$id[1:10]){
print(i)
series <- bind_cols(series, i = gtrends(geo = "DE", time = "all", category = i)$interest_over_time$hits)
}
cat_paper$name[1:10]
series
1:10
categories$id == 569
categories$id == "569"
categories$id
match(categories$id, 569)
match(categories$id, "569")
match(cat$id, 569)
569 %in% cat$id
for (i in cat_paper$id[1:10]){
print(i)
series <- bind_cols(series, i = gtrends(geo = "DE", time = "all", category = i)$interest_over_time$hits)
}
329 %in% cat$id
612 %in% cat$id
cat_paper
cat_paper <- as_tibble(read.csv("Kategorien_Woloszko.csv", head = F))
names(cat_paper) = "name"
cat<- as_tibble(categories)
cat_paper %>%
left_join(cat, by = "name") %>%
unique() -> cat_paper
print(cat_paper, n = 100)
cat_paper <- as_tibble(read.csv("Kategorien_Woloszko.csv", head = F))
names(cat_paper) = "name"
cat<- as_tibble(categories)
cat_paper %>%
left_join(cat, by = "name") %>%
unique() -> cat_paper2
cat_paper$name %in% cat_paper2
cat_paper$name == cat_paper2
cat_paper$name == cat_paper2$name
cat_paper2
cat_paper <- as_tibble(read.csv("Kategorien_Woloszko.csv", head = F))
names(cat_paper) = "name"
cat<- as_tibble(categories)
cat_paper %>%
left_join(cat, by = "name") %>%
unique() -> cat_paper
print(cat_paper, n = 100)
as_tibble(gtrends(geo = "DE", time = "all", category = c(47))$interest_over_time)
series <- tibble(date = seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month"))
for (i in cat_paper$id[1:10]){
print(i)
series <- bind_cols(series, i = gtrends(geo = "DE", time = "all", category = i)$interest_over_time$hits)
}
cat_paper$name[1:10]
length(series)
series
cat_paper$id[1:10]
gtrends(geo = "DE", time = "all", category = "569")
gtrends(geo = "DE", time = "all", category = "329")
gtrends(geo = "DE", time = "all", category = "612")
gtrends(geo = "DE", time = "all", category = "23")
gtrends(geo = "DE", time = "all", category = "330")
series <- tibble(date = seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month"))
for (i in cat_paper$id[1:10]){
if (i %in% categories$id)
#print(i)
series <- bind_cols(series, i = gtrends(geo = "DE", time = "all", category = i)$interest_over_time$hits)
else print(i)
}
series
names(series) <- c("date", cat_paper$name[1:10])
names(series) <- c("date", cat_paper$name[2:10])
series <- pivot_longer(series, cols = -date, names_to = "id", values_to = "hits")
ggplot(series, aes(x = date, y = hits, color = id))
ggplot(series, aes(x = date, y = hits, color = id)) + geom_line()
series <- tibble(date = seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month"))
for (i in cat_paper$id[1:10]){
g <- gtrends(geo = "DE", time = "all", category = i)$interest_over_time
if (is.null(g)) print(i)
else series <- bind_cols(series, i = g$interest_over_time$hits)
}
t = 1:10
t[1:10][-2]
match(t, 4)
which(t, 4)
match(t, 4)
match(t, "4")
which(4 == t)
which(c(4,7) == t)
c(4,7) == t
series <- tibble(date = seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month"))
missing = NULL
for (i in cat_paper$id[1:10]){
g <- gtrends(geo = "DE", time = "all", category = i)$interest_over_time
if (is.null(g)) c(missing, cat_paper$name[i])
else series <- bind_cols(series, i = g$interest_over_time$hits)
}
series
gtrends(geo = "DE", time = "all", category = "330")$interest_over_time
gtrends(geo = "DE", time = "all", category = "615")$interest_over_time
is.null(0)
series <- tibble(date = seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month"))
missing = NULL
for (i in cat_paper$id[1:10]){
g <- gtrends(geo = "DE", time = "all", category = i)$interest_over_time
if (is.null(g)) c(missing, cat_paper$name[i])
else series <- bind_cols(series, i = g$hits)
}
missing
c("a","b")["a"]
series <- tibble(date = seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month"))
missing = NULL
for (i in cat_paper$id[1:10]){
g <- gtrends(geo = "DE", time = "all", category = i)$interest_over_time
if (is.null(g)) c(missing, cat_paper$name[cat_paper$id == i])
else series <- bind_cols(series, i = g$hits)
}
missing
series <- tibble(date = seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month"))
missing = NULL
for (i in cat_paper$id[1:10]){
g <- gtrends(geo = "DE", time = "all", category = i)$interest_over_time
if (is.null(g)) print(i) #c(missing, cat_paper$name[cat_paper$id == i])
else series <- bind_cols(series, i = g$hits)
}
series
cat_paper$name[cat_paper$id == "330"]
cat_paper
missing
c(missing, cat_paper$name[cat_paper$id == i])
c(missing, cat_paper$name[cat_paper$id == 330])
series <- tibble(date = seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month"))
missing = NULL
for (i in cat_paper$id[1:10]){
g <- gtrends(geo = "DE", time = "all", category = i)$interest_over_time
if (is.null(g)) c(missing, cat_paper$name[cat_paper$id == i])
else series <- bind_cols(series, i = g$hits)
}
missing
missing = NULL
series <- tibble(date = seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month"))
missing = NULL
for (i in cat_paper$id[1:10]){
g <- gtrends(geo = "DE", time = "all", category = i)$interest_over_time
if (is.null(g)) c(missing, i)
else series <- bind_cols(series, i = g$hits)
}
missing
c(NULL, 4)
missing = NULL
for (i in cat_paper$id[1:10]){
g <- gtrends(geo = "DE", time = "all", category = i)$interest_over_time
if (is.null(g)) missing <- c(missing, cat_paper$name[cat_paper$id == i])
else series <- bind_cols(series, i = g$hits)
}
missing
setdiff(c("a", "b"), "a")
series <- tibble(date = seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month"))
missing = NULL
for (i in cat_paper$id[1:10]){
g <- gtrends(geo = "DE", time = "all", category = i)$interest_over_time
if (is.null(g)) missing <- c(missing, cat_paper$name[cat_paper$id == i])
else series <- bind_cols(series, i = g$hits)
}
names(series) <- c("date", setdiff(cat_paper$name[1:10], missing))
series <- pivot_longer(series, cols = -date, names_to = "id", values_to = "hits")
series <- bind_cols(series, PC = ts_pick(ts_prcomp(series), "PC1")$value)
ts_pick(ts_prcomp(series), "PC1")
ts_pick(ts_prcomp(series), "PC1")$value
bind_cols(series, PC = ts_pick(ts_prcomp(series), "PC1")$value)
series <- bind_cols(series, PC = ts_pick(ts_prcomp(series), "PC1")$value)
pivot_longer(series, cols = -date, names_to = "id", values_to = "hits") %>%
ggplot(series, aes(x = date, y = hits, color = id)) + geom_line()
series
series$id
series <- tibble(date = seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month"))
missing = NULL
for (i in cat_paper$id[1:10]){
g <- gtrends(geo = "DE", time = "all", category = i)$interest_over_time
if (is.null(g)) missing <- c(missing, cat_paper$name[cat_paper$id == i])
else series <- bind_cols(series, i = g$hits)
}
names(series) <- c("date", setdiff(cat_paper$name[1:10], missing))
series <- bind_cols(series, PC = ts_pick(ts_prcomp(series), "PC1")$value)
ts_pick(ts_prcomp(series), "PC1")
missing
setdiff(cat_paper$name[1:10], missing)
names(series)
series
series[1:10]
series[1:10]
ts_pick(ts_prcomp(series), "PC1")
series <- pivot_longer(series, cols = -date, names_to = "id", values_to = "hits")
ts_pick(ts_prcomp(series), "PC1")
series <- tibble(date = seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month"))
missing = NULL
for (i in cat_paper$id[1:10]){
g <- gtrends(geo = "DE", time = "all", category = i)$interest_over_time
if (is.null(g)) missing <- c(missing, cat_paper$name[cat_paper$id == i])
else series <- bind_cols(series, i = g$hits)
}
names(series) <- c("date", setdiff(cat_paper$name[1:10], missing))
series %>%
pivot_longer(cols = -date, names_to = "id", values_to = "hits") %>%
bind_cols(PC = ts_pick(ts_prcomp(series), "PC1")$value) ->
ggplot(series, aes(x = date, y = hits, color = id)) +
geom_line()
series %>%
pivot_longer(cols = -date, names_to = "id", values_to = "hits") %>%
bind_cols(PC = ts_pick(ts_prcomp(.), "PC1")$value) ->
ggplot(series, aes(x = date, y = hits, color = id)) +
geom_line()
dates <- seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month")
as_tibble(gtrends(geo = "DE", time = "all", category = c(47))$interest_over_time)
series %>%
pivot_longer(cols = -date, names_to = "id", values_to = "hits") %>%
bind_rows(date = dates, hits =  ts_pick(ts_prcomp(.), "PC1")$value) -> series
tb
tibble
t
t = tibble( a = 1:10, b = "a")
t
bind_rows(t, a = 10:1, b = "q")
?bind_rows
series %>%
pivot_longer(cols = -date, names_to = "id", values_to = "hits") %>%
rename(time = date, value = hits)
bind_rows(ts_pick(ts_prcomp(.), "PC1")$value) -> series
ts_pick(ts_prcomp(.), "PC1")
ts_pick(ts_prcomp(series), "PC1")
series %>%
pivot_longer(cols = -date, names_to = "id", values_to = "hits") %>%
ts_pick(ts_prcomp(.), "PC1")
series <- tibble(date = dates)
missing = NULL
for (i in cat_paper$id[1:10]){
g <- gtrends(geo = "DE", time = "all", category = i)$interest_over_time
if (is.null(g)) missing <- c(missing, cat_paper$name[cat_paper$id == i])
else series <- bind_cols(series, i = g$hits)
}
names(series) <- c("date", setdiff(cat_paper$name[1:10], missing))
series <- tibble(date = dates)
missing = NULL
for (i in cat_paper$id[1:5]){
g <- gtrends(geo = "DE", time = "all", category = i)$interest_over_time
if (is.null(g)) missing <- c(missing, cat_paper$name[cat_paper$id == i])
else series <- bind_cols(series, i = g$hits)
}
names(series) <- c("date", setdiff(cat_paper$name[1:5], missing))
series %>%
pivot_longer(cols = -date, names_to = "id", values_to = "hits") %>%
ts_pick(ts_prcomp(.), "PC1")
series %>%
pivot_longer(cols = -date, names_to = "id", values_to = "hits") -> series
ts_pick(ts_prcomp(series), "PC1")
series
pc <- ts_pick(ts_prcomp(series), "PC1")
ggplot(pc, aes(x = time, y = value, color = id)) +
geom_line()
series <- tibble(date = dates)
missing = NULL
for (i in cat_paper$id){
g <- gtrends(geo = "DE", time = "all", category = i)$interest_over_time
if (is.null(g)) missing <- c(missing, cat_paper$name[cat_paper$id == i])
else series <- bind_cols(series, i = g$hits)
}
missing
names(series) <- c("date", setdiff(cat_paper$name, missing))
series %>%
pivot_longer(cols = -date, names_to = "id", values_to = "hits") -> series
pc <- ts_pick(ts_prcomp(series), "PC1")
ggplot(series, aes(x = date, y = hits, color = id)) +
geom_line()
ggplot(series, aes(x = date, y = hits, color = id)) +
geom_line() +
theme(legend.position = "none")
ggplot(pc, aes(x = time, y = value, color = id)) +
geom_line()
ts_prcomp(series)
pc <- ts_pick(ts_prcomp(series), c("PC1", "PC2"))
ggplot(pc, aes(x = time, y = value, color = id)) +
geom_line()
pc <- ts_pick(ts_prcomp(series), c("PC1", "PC2", "PC3", "PC4", "PC5"))
ggplot(pc, aes(x = time, y = value, color = id)) +
geom_line()
series
pivot_wider(series, names_from = id, values_from = hits)
pivot_wider(pc, names_from = id, values_from = value)
pc <- rename(pivot_wider(pc, names_from = id, values_from = value), date = time)
pc
left_join(pc, series, by = "date")
series <- pivot_wider(series, names_from = id, values_from = hits)
pc <- rename(pivot_wider(pc, names_from = id, values_from = value), date = time)
pc
left_join(pc, series, by = "date")
library(openxlsx)
write.xlsx(left_join(pc, series, by = "date"), file = "Kategorien_und_PC.xlsx")
?ts_prcomp
library(devtools)
use_r("Trends.R")
use_r("Estimation.R")
use_r("Google_Kategorien")
use_package("tidyverse")
library(devtools)
use_package("tidyverse")
use_package("tidyverse", type = "depends")
use_package("corrr")
use_package("gtrendsR")
use_package("trendecon")
use_package("openxlsx")
use_package("lubridate")
getwd()
?prcomp
library(tidyverse)
library(gtrendsR)
library(trendecon)
library(openxlsx)
dates <- seq.Date(from = as.Date( "2004-01-01"), to = as.Date("2021-08-01"), by = "month")
####################Tibble mit Kategorien aus dem Paper erstellen
cat_paper <- as_tibble(read.csv("Kategorien_Woloszko.csv", head = F))
names(cat_paper) = "name"
cat<- as_tibble(categories)
cat_paper %>%
left_join(cat, by = "name") %>%
unique() -> cat_paper
##################Tibble mit Zeitreihen erstellen
series <- tibble(date = dates)
missing = NULL
for (i in cat_paper$id){
g <- gtrends(geo = "DE", time = "all", category = i)$interest_over_time
if (is.null(g)) missing <- c(missing, cat_paper$name[cat_paper$id == i])
else series <- bind_cols(series, i = g$hits)
}
ts_prcomp(series2)$rotation
library(tsbox)
ts_prcomp(series2)$rotation
names(series) <- c("date", setdiff(cat_paper$name, missing))
series %>%
pivot_longer(cols = -date, names_to = "id", values_to = "hits") -> series2
ts_prcomp(series2)$rotation
ts_prcomp(series2)
prcomp(series2)
series2
class(ts_prcomp(series2))
prcomp(ts_ts(series2))
series
prcomp(series)
prcomp(series[2:86])
p = prcomp(series[2:86])
p$x
plot(p$x$PC1, type = "l"
)
plot(p$x$PC1, type = "l")
plot((p$x)$PC1, type = "l")
p$x
p$x$PC1
p1 = p$x
p1$PC1
p1[,85]
plot(p$x[,1], type = "l")
plot(p$x[,2], type = "l")
pc <- ts_pick(ts_prcomp(series2), c("PC1", "PC2", "PC3", "PC4", "PC5"))
ggplot(pc, aes(x = time, y = value, color = id)) +
geom_line()
plot(p$x[,1], type = "l")
p = prcomp(series[2:86], retx = T)
plot(p$x[,1], type = "l")
p = prcomp(series[2:86], retx = T, scale. = T)
plot(p$x[,1], type = "l")
p$x[,1]
#####Exportieren
# series2 <- pivot_wider(series2, names_from = id, values_from = hits)
pc <- rename(pivot_wider(pc, names_from = id, values_from = value), date = time)
pc$PC1
########plots
ggplot(series2, aes(x = date, y = hits, color = id)) +
geom_line() +
theme(legend.position = "none")
pc
loadings(pc)
loadings(prcomp(series, scale. = T))
prcomp(series[2:86] scale. = T)
prcomp(series[2:86], scale. = T)
p$x[,1]
series
load <- prcomp(series[-1], scale. = T)$x
load
plot(load[,1])
load <- prcomp(series[-1], scale. = T)$rotation
laod
load
load <- prcomp(series[-1], scale. = T)$rotation[,1:5]
load
use_r("keywords_paper")
ind_activ <- c('Agriculture & Forestry', 'Agrochemicals', 'Aviation', 'Business & Industrial',
'Chemicals Industry', 'Textiles & Nonwovens', 'Coatings & Adhesives', 'Food Production',
'Dyes & Pigments', 'Freight & Trucking', 'Transportation & Logistics', 'Mail & Package Delivery',
'Manufacturing')
ind_activ <- c('Agriculture & Forestry', 'Agrochemicals', 'Aviation', 'Business & Industrial',
'Chemicals Industry', 'Textiles & Nonwovens', 'Coatings & Adhesives', 'Food Production',
'Dyes & Pigments', 'Freight & Trucking', 'Transportation & Logistics', 'Mail & Package Delivery',
'Manufacturing')
ind_activ <- c('Agriculture & Forestry', 'Agrochemicals', 'Aviation', 'Business & Industrial',
'Chemicals Industry', 'Textiles & Nonwovens', 'Coatings & Adhesives', 'Food Production',
'Dyes & Pigments', 'Freight & Trucking', 'Transportation & Logistics', 'Mail & Package Delivery',
'Manufacturing')
ind_activ
kw <- ind_activ
ts_gtrends(
keyword = kw,
geo = "DE",
time = "all"
) %>%
filter(time >= as.Date("2006-01-01") & time <= as.Date("2021-06-01")) -> dat
kw <- ind_activ
ts_gtrends(
keyword = kw,
geo = "US",
time = "all"
) %>%
filter(time >= as.Date("2006-01-01") & time <= as.Date("2021-06-01")) -> dat
dat$time
index_paper <-as.tibble(read.csv("https://raw.githubusercontent.com/trendecon/data/master/data/de/trendecon_sa.csv"))
index_paper %>%
mutate(time = floor_date(as.Date(time), "month")) %>%
group_by(time) %>%
mutate(Index_paper = mean(value)) %>%
select(-value) %>%
unique() %>%
mutate(time = as.Date(time)) %>%
filter((time >= as.Date("2006-01-01") & time <= as.Date("2021-06-01")))-> index_paper
library(tidyverse)
library(gtrendsR)
library(trendecon)
library(openxlsx)
library(corrr)
library(lubridate)
index_paper <-as.tibble(read.csv("https://raw.githubusercontent.com/trendecon/data/master/data/de/trendecon_sa.csv"))
index_paper %>%
mutate(time = floor_date(as.Date(time), "month")) %>%
group_by(time) %>%
mutate(Index_paper = mean(value)) %>%
select(-value) %>%
unique() %>%
mutate(time = as.Date(time)) %>%
filter((time >= as.Date("2006-01-01") & time <= as.Date("2021-06-01")))-> index_paper
pca <- function(series, start = "2014-01-01", end = max(series$time)){
period <- seq.Date(as.Date(start), as.Date(end), by = "month")
dates <- seq.Date(as.Date("2006-01-01"), as.Date(end), by = "month")
pc <- tibble(id = "PC1", time = dates)
n <- length(dates)#L?nge der ganzen Reihe
for(i in period){ #L?nge der Periode oft
d <- as.Date(i, origin = "1970-01-01")
series %>%
filter(time <= d) -> temp
pc_temp <- ts_pick(ts_prcomp(temp), "PC1")
pc <- bind_cols(pc, tibble(n = c(pc_temp$value, rep(NA, (n-length(pc_temp$value))))))
}
return(pc)
}
tb <- pca(dat, start = "2014-01-01", end = "2021-06-01")
dat_ger <- readxl::read_xlsx("Deutschland-Daten.xlsx", sheet = "Monatsdaten")
dat_ger %>%
mutate(time = as.Date(Monatsdaten)) %>%
select(time, Ifo_new, Erwartungm_new, VDAXm, policym, Retailsalesm, GFK) %>%
filter((time >= as.Date("2006-01-01") & time <= as.Date("2021-07-01"))) %>%
mutate(time = floor_date(time, "month"),
Ifo_new = as.numeric(Ifo_new),
Retailsalesm = as.numeric(Retailsalesm)) %>%
mutate(Retailsalesm_growth = (Retailsalesm - lag(Retailsalesm))/Retailsalesm) -> dat_ger
##################Unseren Index erstellen und zusammenf?gen
ts_pick(ts_prcomp(dat), "PC1") %>%
select(time, value) %>%
right_join(dat_ger, by = "time") %>%
right_join(index_paper, by = "time") %>%
rename(Index = value) %>%
#mutate(Index = -(Index-mean(Index))/sd(Index)) %>%
relocate(Index_paper, .after = Index) -> dat_comp
