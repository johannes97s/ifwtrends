}
if(trend && trend_method == "comtrend"){
if (("id" %in% names(series))) fit <- lm(value ~ id -1 +poly(as.numeric(time), 3, raw = T), data = series)
else fit <- lm(value ~ +poly(as.numeric(time), 3, raw = T), data = series)
series <- mutate(series, value = fit$residuals)
}
if(seas && seas_method = "firstdiff"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- series %>%
group_by(id) %>%
mutate(value = c(rep(0,4), diff(value, 4)))
}
series
}
#'
#'For trend_method there can be choosen \code{"firstdiff"} and \code{"comtrend"}.
#'If \code{"firstdiff"}, first differences with \code{lag = 1} is executed.
#'If \code{"comtrend"}, there is a polynom of degree 5 with id-Fixed Effects estimated, which captures the common trend. The residuals where then used as the adjusted series. For further Detial see Woloszko et.al. (2020)
#'
#'@example
#'series <- ts_gtrends(c("ikea", "saturn"), time = "all")
#'ser_adj(series, trend = T, trend_method = "firstdiff")
#'
#'@export
ser_adj <- function(series, trend = T, seas = T, trend_method = "firstdiff", seas_method = "firsdiff"){
series <- mutate(series, value = log(value))
if(seas && seas_method == "arima"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series %>%
group_by(id) %>%
mutate(value = seasonal::final(seasonal::seas()))
}
if(trend && trend_method == "firstdiff"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- series %>%
group_by(id) %>%
mutate(value = c(0, diff(value))) %>%
ungroup()
}
if(trend && trend_method == "comtrend"){
if (("id" %in% names(series))) fit <- lm(value ~ id -1 +poly(as.numeric(time), 3, raw = T), data = series)
else fit <- lm(value ~ +poly(as.numeric(time), 3, raw = T), data = series)
series <- mutate(series, value = fit$residuals)
}
if(seas && seas_method = "firstdiff"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- series %>%
group_by(id) %>%
mutate(value = c(rep(0,4), diff(value, 4)))
}
series
}
#'
#'For trend_method there can be choosen \code{"firstdiff"} and \code{"comtrend"}.
#'If \code{"firstdiff"}, first differences with \code{lag = 1} is executed.
#'If \code{"comtrend"}, there is a polynom of degree 5 with id-Fixed Effects estimated, which captures the common trend. The residuals where then used as the adjusted series. For further Detial see Woloszko et.al. (2020)
#'
#'@example
#'series <- ts_gtrends(c("ikea", "saturn"), time = "all")
#'ser_adj(series, trend = T, trend_method = "firstdiff")
#'
#'@export
ser_adj <- function(series, trend = T, seas = T, trend_method = "firstdiff", seas_method = "firsdiff"){
series <- mutate(series, value = log(value))
if(seas && seas_method == "arima"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series %>%
group_by(id) %>%
mutate(value = seasonal::final(seasonal::seas()))
}
if(trend && trend_method == "firstdiff"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- series %>%
group_by(id) %>%
mutate(value = c(0, diff(value))) %>%
ungroup()
}
if(trend && trend_method == "comtrend"){
if (("id" %in% names(series))) fit <- lm(value ~ id -1 +poly(as.numeric(time), 3, raw = T), data = series)
else fit <- lm(value ~ +poly(as.numeric(time), 3, raw = T), data = series)
series <- mutate(series, value = fit$residuals)
}
if(seas && seas_method = "firstdiff"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- series %>%
group_by(id) %>%
mutate(value = c(rep(0,4), diff(value, 4)))
}
series
}
series <- mutate(series, value = log(value))
series = ts_gtrends("ikea", time = "all")
series <- mutate(series, value = log(value))
series = ts_gtrends("ikea", time = "all")
seas = F
trend_method = "comtrend"
series <- mutate(series, value = log(value))
if(seas && seas_method == "arima"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series %>%
group_by(id) %>%
mutate(value = seasonal::final(seasonal::seas()))
}
if(trend && trend_method == "firstdiff"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- series %>%
group_by(id) %>%
mutate(value = c(0, diff(value))) %>%
ungroup()
}
trend = T
if(trend && trend_method == "firstdiff"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- series %>%
group_by(id) %>%
mutate(value = c(0, diff(value))) %>%
ungroup()
}
if(trend && trend_method == "comtrend"){
if (("id" %in% names(series))) fit <- lm(value ~ id -1 +poly(as.numeric(time), 3, raw = T), data = series)
else fit <- lm(value ~ +poly(as.numeric(time), 3, raw = T), data = series)
series <- mutate(series, value = fit$residuals)
}
if(seas && seas_method = "firstdiff"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- series %>%
group_by(id) %>%
mutate(value = c(rep(0,4), diff(value, 4)))
}
if(seas && seas_method = "firstdiff"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- series %>%
group_by(id) %>%
mutate(value = c(rep(0,4), diff(value, 4)))
}
if(seas && seas_method == "firstdiff"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- series %>%
group_by(id) %>%
mutate(value = c(rep(0,4), diff(value, 4)))
}
#'
#'For trend_method there can be choosen \code{"firstdiff"} and \code{"comtrend"}.
#'If \code{"firstdiff"}, first differences with \code{lag = 1} is executed.
#'If \code{"comtrend"}, there is a polynom of degree 5 with id-Fixed Effects estimated, which captures the common trend. The residuals where then used as the adjusted series. For further Detial see Woloszko et.al. (2020)
#'
#'@example
#'series <- ts_gtrends(c("ikea", "saturn"), time = "all")
#'ser_adj(series, trend = T, trend_method = "firstdiff")
#'
#'@export
ser_adj <- function(series, trend = T, seas = T, trend_method = "firstdiff", seas_method = "firsdiff"){
series <- mutate(series, value = log(value))
if(seas && seas_method == "arima"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series %>%
group_by(id) %>%
mutate(value = seasonal::final(seasonal::seas()))
}
if(trend && trend_method == "firstdiff"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- series %>%
group_by(id) %>%
mutate(value = c(0, diff(value))) %>%
ungroup()
}
if(trend && trend_method == "comtrend"){
if (("id" %in% names(series))) fit <- lm(value ~ id -1 +poly(as.numeric(time), 3, raw = T), data = series)
else fit <- lm(value ~ +poly(as.numeric(time), 3, raw = T), data = series)
series <- mutate(series, value = fit$residuals)
}
if(seas && seas_method == "firstdiff"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- series %>%
group_by(id) %>%
mutate(value = c(rep(0,4), diff(value, 4)))
}
series
}
ser_adj(series, seas = F, trend = T, trend_method = "comtrend")
series
ts_gtrends("ikea", time = "all")
series = ts_gtrends("ikea", time = "all")
ser_adj(series, seas = F, trend = T, trend_method = "comtrend")
adj <- ser_adj(series, seas = F, trend = T, trend_method = "comtrend")
ts_ggplot(adj)
seas(ts_ts(adj))
plot(seas(ts_ts(adj)))
series = ts_ts(ts_gtrends("ikea", time = "all"))
series = ts_ts(ts_gtrends(c("saturn","ikea", time = "all"))
series = ts_ts(ts_gtrends(c("saturn","ikea"), time = "all"))
series = ts_ts(ts_gtrends(c("saturn","ikea"), time = "all"))
series
series = list(ts_ts(ts_gtrends(c("saturn","ikea"), time = "all")))
series = as.list(ts_ts(ts_gtrends(c("saturn","ikea"), time = "all")))
series
seas(ts_ts(adj))
seas(ts_ts(series))
seas((series))
final(seas((series)))
ts_tbl(.Last.value)
series = ts_gtrends(c("saturn","ikea"), time = "all"))
series = ts_gtrends(c("saturn","ikea"), time = "all")
series
#'
#'For trend_method there can be choosen \code{"firstdiff"} and \code{"comtrend"}.
#'If \code{"firstdiff"}, first differences with \code{lag = 1} is executed.
#'If \code{"comtrend"}, there is a polynom of degree 5 with id-Fixed Effects estimated, which captures the common trend. The residuals where then used as the adjusted series. For further Detial see Woloszko et.al. (2020)
#'
#'@example
#'series <- ts_gtrends(c("ikea", "saturn"), time = "all")
#'ser_adj(series, trend = T, trend_method = "firstdiff")
#'
#'@export
ser_adj <- function(series, trend = T, seas = T, trend_method = "firstdiff", seas_method = "firsdiff"){
series <- mutate(series, value = log(value))
if(seas && seas_method == "arima"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- as.list(ts_ts(series))
series <- ts_tbl(final(seas(series)))
}
if(trend && trend_method == "firstdiff"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- series %>%
group_by(id) %>%
mutate(value = c(0, diff(value))) %>%
ungroup()
}
if(trend && trend_method == "comtrend"){
if (("id" %in% names(series))) fit <- lm(value ~ id -1 +poly(as.numeric(time), 3, raw = T), data = series)
else fit <- lm(value ~ +poly(as.numeric(time), 3, raw = T), data = series)
series <- mutate(series, value = fit$residuals)
}
if(seas && seas_method == "firstdiff"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- series %>%
group_by(id) %>%
mutate(value = c(rep(0,4), diff(value, 4)))
}
series
}
end = "2019-12-31"
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end)))
library(tidyverse)
library(gtrendsR)
library(trendecon)
library(tsbox)
library(zoo)
end = "2019-12-31"
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end)))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = "1003",
category = 0,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
g_dat <- ser_adj(g_dat, trend = T, seas = T, trend_method = "firstdiff", seas_method = "arima")
g_dat
ts_ts(g_dat)
dat
as.yearqtr("2020-01-01")
as.Date(as.yearqtr("2020-01-01"))
end = "2019-12-31"
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end))) %>%
mutate(time <- as.Date(time))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = "1003",
category = 0,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
mutate(time <- as.Date(time)) %>%
filter(time <= max(dat$time))
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end))) %>%
mutate(time <- as.Date(time))
dat
end = "2019-12-31"
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end))) %>%
mutate(time = as.Date(time))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = "1003",
category = 0,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
mutate(time = as.Date(time)) %>%
filter(time <= max(dat$time))
dat
g_dat
end = "2019-12-31"
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end))) %>%
mutate(time = as.Date(time))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = "1003",
category = 0,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
mutate(time = as.Date(time)) %>%
filter(time <= max(dat$time))
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
g_dat <- ser_adj(g_dat, trend = T, seas = T, trend_method = "firstdiff", seas_method = "arima")
plot(dat$time, dat$value, type = "l")
plot(dat$time, dat$value, type = "l")
plot(g_dat$time, g_dat$value, type = "l")
plot(dat$time, dat$value, type = "l")
x <- g_dat$value[-(1:4)]
y <- dat$value[-(1:4)]
ccf(x,y, lag = 2, type = "correlation", plot = F)
plot(lag(x),y)
summary(lm(y~lag(x)))
df <- tibble(x = x, y = y) %>%
filter(abs(x) < quantile(abs(x), 0.95) & abs(y) < quantile(abs(y), 0.95))
summary(lm(y~x, data = df))
plot(df)
end = "2019-12-31"
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end))) %>%
mutate(time = as.Date(time))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = "1003",
category = 0,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
mutate(time = as.Date(time)) %>%
filter(time <= max(dat$time))
dat <- ser_adj(dat, trend = F, seas = F, trend_method = "firstdiff")
g_dat <- ser_adj(g_dat, trend = F, seas = T, trend_method = "firstdiff", seas_method = "arima")
plot(dat$time, dat$value, type = "l")
plot(g_dat$time, g_dat$value, type = "l")
g_dat <- ts_gtrends(keyword = "1003",
category = 0,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
mutate(time = as.Date(time)) %>%
filter(time <= max(dat$time))
g_dat <- ser_adj(g_dat, trend = F, seas = F, trend_method = "firstdiff", seas_method = "arima")
plot(dat$time, dat$value, type = "l")
plot(g_dat$time, g_dat$value, type = "l")
g_dat <- ser_adj(g_dat, trend = F, seas = T, trend_method = "firstdiff", seas_method = "arima")
plot(g_dat$time, g_dat$value, type = "l")
g_dat <- ts_gtrends(keyword = "1003",
category = 0,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
mutate(time = as.Date(time)) %>%
filter(time <= max(dat$time))
g_dat <- ser_adj(g_dat, trend = F, seas = F, trend_method = "firstdiff", seas_method = "arima")
plot(g_dat$time, g_dat$value, type = "l")
g_dat <- ts_gtrends(keyword = "1003",
category = 0,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
mutate(time = as.Date(time)) %>%
filter(time <= max(dat$time))
plot(g_dat)
g_dat <- ts_gtrends(keyword = "1003",
category = 0,
geo = "DE",
time = time)
g_dat
plot(g_dat, type = "l")
g_dat <- ts_gtrends(keyword = NA,
category = "1003",
geo = "DE",
time = time)
plot(g_dat, type = "l")
g_dat <- ts_gtrends(keyword = NA,
category = "1003",
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
mutate(time = as.Date(time)) %>%
filter(time <= max(dat$time))
plot(g_dat$time, g_dat$value, type = "l")
g_dat <- ser_adj(g_dat, trend = F, seas = T, trend_method = "firstdiff", seas_method = "arima")
plot(g_dat$time, g_dat$value, type = "l")
ts_gtrends(keyword = NA,
category = c(1003,651),
geo = "DE",
time = time)
categories
all <- ts_gtrends(category = categories$id, time = "all")
all <- ts_gtrends(keyword = NA, category = categories$id, time = "all")
all <- ts_gtrends(keyword = NA, category = categories$id[-1], time = "all")
all
all <- ts_gtrends(keyword = NA, category = c(651,330), time = "all")
all <- ts_gtrends(keyword = NA, category = c(651,330), time = "all")
all <- ts_gtrends(keyword = NA, category = c(651,330), time = "all")
all <- ts_gtrends(keyword = NA, category = c(651, 1003), time = "2006-01-01 2021-09-01")
ts_gtrends("ikea")
t <- .Last.value
t
frequency(t)
library(tsibble)
guess_frequency(t)
as_tsibble(t)
t <- as_tsibble(t)
t
guess_frequency(t)
library(forecast)
findfrequency(t)
ts_ts(t)
t
load_all
load_all()
library(devtools)
load_all()
build()
check()
use_build_ignore("data")
devtools::check()
install("~/ifwtrends")
install("~/Documents/ifwtrends")
.Last.error
check()
check()
rlang::last_error()
ts_gtrends("ikea")
warnings()
ts_gtrends(category = 1003)
ts_gtrends(keyword=  NA, category = 1003)
ts_gtrends(keyword=  NA, category = c(330,1003))
as_tibble(gtrends(
keyword = NA,
category = 0,
geo = geo,
time = "all")$interest_over_time)
as_tibble(gtrends(
keyword = NA,
category = 0,
geo = "DE",
time = "all")$interest_over_time)
as_tibble(gtrends(
keyword = NA,
category = 0,
geo = "DE",
time = "all")
)
gtrends(
keyword = NA,
category = 0,
geo = "DE",
time = "all")
gtrends(
keyword = NA,
category = 651,
geo = "DE",
time = "all")
