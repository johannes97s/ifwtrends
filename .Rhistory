categories_paper$category
g_dat <- ts_gtrends(keyword = NA,
category = 67
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique()
ts_gtrends(keyword = NA,
category = 67
geo = "DE",
time = time)
g_dat <- ts_gtrends(keyword = NA,
category = 67,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique()
g_dat <- ser_adj(g_dat, trend = T, seas = T, trend_method = "firstdiff")
plot(g_dat$time, g_dat$value, type = "l")
plot(dat$time, dat$value, type = "l")
plot(g_dat$time, g_dat$value, type = "l")
x <- g_dat$value[-(1:4)]
y <- dat$value[-(1:4)]
plot(x,y)
end = Sys.Date()
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end)))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = NA,
category = 67,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique()
dat
g_dat
g_dat <- ts_gtrends(keyword = NA,
category = 67,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
g_dat
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
g_dat <- ser_adj(g_dat, trend = T, seas = T, trend_method = "firstdiff")
plot(g_dat$time, g_dat$value, type = "l")
plot(dat$time, dat$value, type = "l")
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
end = Sys.Date()
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end)))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = NA,
category = 67,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
g_dat <- ser_adj(g_dat, trend = T, seas = T, trend_method = "firstdiff")
plot(g_dat$time, g_dat$value, type = "l")
plot(dat$time, dat$value, type = "l")
x <- g_dat$value[-(1:4)]
y <- dat$value[-(1:4)]
plot(x,y)
x
df <- tibble(x = x, y = y) %>%
filter(abs(x) < quantile(abs(x), 0.9) & abs(y) < quantile(abs(y), 0.9))
df
df <- tibble(x = x, y = y) %>%
filter(abs(x) < quantile(abs(x), 0.95) & abs(y) < quantile(abs(y), 0.95))
df
plot(df)
df <- tibble(x = x, y = y)
plot(df)
lm(y~x)
plot(lm(y~x))
lm(y~x)
summary(lm(y~x))
summary(lm(y~x))
df <- tibble(x = x, y = y) %>%
filter(abs(x) < quantile(abs(x), 0.95) & abs(y) < quantile(abs(y), 0.95))
summary(lm(y~y, data = df))
summary(lm(y~x, data = df))
summary(lm(y~x))
summary(lm(y~x, data = df))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = NA,
category = 1003,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
end = Sys.Date()
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end)))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = NA,
category = 1003,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
g_dat <- ser_adj(g_dat, trend = T, seas = T, trend_method = "firstdiff")
plot(g_dat$time, g_dat$value, type = "l")
plot(dat$time, dat$value, type = "l")
x <- g_dat$value[-(1:4)]
y <- dat$value[-(1:4)]
plot(x,y)
summary(lm(y~x))
df <- tibble(x = x, y = y) %>%
filter(abs(x) < quantile(abs(x), 0.95) & abs(y) < quantile(abs(y), 0.95))
summary(lm(y~x, data = df))
plot(df)
g_dat <- ts_gtrends(keyword = NA,
category = 208,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
g_dat <- ser_adj(g_dat, trend = T, seas = T, trend_method = "firstdiff")
end = Sys.Date()
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end)))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = NA,
category = 208,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
g_dat <- ser_adj(g_dat, trend = T, seas = T, trend_method = "firstdiff")
plot(g_dat$time, g_dat$value, type = "l")
plot(dat$time, dat$value, type = "l")
plot(g_dat$time, g_dat$value, type = "l")
plot(dat$time, dat$value, type = "l")
x <- g_dat$value[-(1:4)]
y <- dat$value[-(1:4)]
plot(x,y)
summary(lm(y~x))
df <- tibble(x = x, y = y) %>%
filter(abs(x) < quantile(abs(x), 0.95) & abs(y) < quantile(abs(y), 0.95))
summary(lm(y~x, data = df))
plot(df)
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = NA,
category = 1010,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
end = Sys.Date()
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end)))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = NA,
category = 1010,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
g_dat <- ser_adj(g_dat, trend = T, seas = T, trend_method = "firstdiff")
plot(g_dat$time, g_dat$value, type = "l")
plot(g_dat$time, g_dat$value, type = "l")
plot(dat$time, dat$value, type = "l")
plot(g_dat$time, g_dat$value, type = "l")
plot(dat$time, dat$value, type = "l")
plot(g_dat$time, g_dat$value, type = "l")
tail(g_dat)
x <- g_dat$value[-(1:4)]
y <- dat$value[-(1:4)]
plot(x,y)
df <- tibble(x = x, y = y) %>%
filter(abs(x) < quantile(abs(x), 0.95) & abs(y) < quantile(abs(y), 0.95))
plot(df)
summary(lm(y~x, data = df))
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx")
plot(dat, type = "l")
end = "2019-12-31"
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end)))
end = "2019-12-31"
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end)))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = NA,
category = 1010,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
dat
g_dat
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
g_dat <- ser_adj(g_dat, trend = T, seas = T, trend_method = "firstdiff")
plot(g_dat$time, g_dat$value, type = "l")
plot(dat$time, dat$value, type = "l")
plot(dat$time, dat$value, type = "l")
plot(g_dat$time, g_dat$value, type = "l")
plot(dat$time, dat$value, type = "l")
#'
#'For trend_method there can be choosen \code{"firstdiff"} and \code{"comtrend"}.
#'If \code{"firstdiff"}, first differences with \code{lag = 1} is executed.
#'If \code{"comtrend"}, there is a polynom of degree 5 with id-Fixed Effects estimated, which captures the common trend. The residuals where then used as the adjusted series. For further Detial see Woloszko et.al. (2020)
#'
#'@example
#'series <- ts_gtrends(c("ikea", "saturn"), time = "all")
#'ser_adj(series, trend = T, trend_method = "firstdiff")
#'
#'@export
ser_adj <- function(series, trend = T, seas = T, trend_method = "firstdiff", seas_method = "firsdiff"){
series <- mutate(series, value = log(value))
if(trend && trend_method == "firstdiff"){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- series %>%
group_by(id) %>%
mutate(value = c(0, diff(value))) %>%
ungroup()
}
if(trend && trend_method == "comtrend"){
if (("id" %in% names(series))) fit <- lm(value ~ id -1 +poly(as.numeric(time), 3, raw = T), data = series)
else fit <- lm(value ~ +poly(as.numeric(time), 3, raw = T), data = series)
series <- mutate(series, value = fit$residuals)
}
if(seas){
if (!("id" %in% names(series))) series <- mutate(series, id = "id")
series <- series %>%
group_by(id) %>%
mutate(value = c(rep(0,4), diff(value, 4)))
}
series
}
end = "2019-12-31"
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end)))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = NA,
category = 1010,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
g_dat <- ser_adj(g_dat, trend = T, seas = T, trend_method = "firstdiff")
plot(dat$time, dat$value, type = "l")
plot(g_dat$time, g_dat$value, type = "l")
plot(dat$time, dat$value, type = "l")
dat
g_dat
x <- g_dat$value[-(1:4)]
y <- dat$value[-(1:4)]
plot(x,y)
summary(lm(y~x))
g_dat <- ts_gtrends(keyword = NA,
category = 67,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
g_dat <- ser_adj(g_dat, trend = T, seas = T, trend_method = "firstdiff")
plot(dat$time, dat$value, type = "l")
plot(g_dat$time, g_dat$value, type = "l")
x <- g_dat$value[-(1:4)]
y <- dat$value[-(1:4)]
plot(x,y)
summary(lm(y~x))
lm(1:10+1~7:16)
lm((1:10+1)~(7:16))
1:10
7:16
a = 1:10
a = 1:10+1
a
b = 7:16
lm(b ~ a)
summary(lm(b ~ a))
pcf
?pfc
library(correlate)
library(corrr)
?pcf
pacf(x,y)
pacf(x,y, lag = 2)
pacf(x,y, lag = 2, pl = F)
x <- g_dat$value[-(1:4)]
y <- dat$value[-(1:4)]
pacf(x,y, lag = 2, pl = F)
x
class(x)
typeof(x)
pacf(x, lag = 2, pl = F)
?ccf
ccf(x, lag = 2, type = "correlation", plot = F)
ccf(x,y, lag = 2, type = "correlation", plot = F)
end = "2019-12-31"
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end)))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = NA,
category = 1010,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
g_dat <- ser_adj(g_dat, trend = T, seas = T, trend_method = "firstdiff")
plot(dat$time, dat$value, type = "l")
plot(g_dat$time, g_dat$value, type = "l")
x <- g_dat$value[-(1:4)]
y <- dat$value[-(1:4)]
ccf(x,y, lag = 2, type = "correlation", plot = F)
x
lag(x)
plot(lag(x),y)
summary(lm(y~lag(x)))
end = "2019-12-31"
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end)))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = NA,
category = 1010,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
g_dat <- ser_adj(g_dat, trend = T, seas = T, trend_method = "firstdiff")
plot(dat$time, dat$value, type = "l")
plot(g_dat$time, g_dat$value, type = "l")
x <- g_dat$value[-(1:4)]
y <- dat$value[-(1:4)]
ccf(x,y, lag = 2, type = "correlation", plot = F)
plot(lag(x),y)
summary(lm(y~lag(x)))
x
lag(x)
g_dat <- ts_gtrends(keyword = "Hotel Italien",
category = 0,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
g_dat <- ser_adj(g_dat, trend = T, seas = T, trend_method = "firstdiff")
x <- g_dat$value[-(1:4)]
y <- dat$value[-(1:4)]
ccf(x,y, lag = 2, type = "correlation", plot = F)
plot(lag(x),y)
summary(lm(y~lag(x)))
end = "2019-12-31"
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end)))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = "1003",
category = 0,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
g_dat <- ser_adj(g_dat, trend = T, seas = T, trend_method = "firstdiff")
plot(dat$time, dat$value, type = "l")
plot(g_dat$time, g_dat$value, type = "l")
x <- g_dat$value[-(1:4)]
y <- dat$value[-(1:4)]
ccf(x,y, lag = 2, type = "correlation", plot = F)
plot(lag(x),y)
summary(lm(y~lag(x)))
?ccf
library(seasonal)
install.packages("seasonal")
use_package("seasonal")
library(seasonal)
plot(AirPassengers)
AriPassengers
AirPassengers
seas(AirPassengers,x11 = "")
lines(final(sa_series),col=2)
sa = seas(AirPassengers,x11 = "")
lines(final(sa),col=2)
lines(final(sa))
final(sa)
end = "2019-12-31"
dat <- readxl::read_xlsx("~/Google Trends/Service_Import.xlsx") %>%
mutate(time = as.yearqtr(as.Date(Name))) %>%
select(time, value = `BD IMPORTS - SERVICES CONA`) %>%
filter(time <= as.yearqtr(as.Date(end)))
time = str_c("2006-01-01 ", end)
g_dat <- ts_gtrends(keyword = "1003",
category = 0,
geo = "DE",
time = time) %>%
mutate(time = as.yearqtr(time)) %>%
group_by(time) %>%
mutate(value = mean(value)) %>%
ungroup() %>%
unique() %>%
filter(time <= max(dat$time))
dat <- ser_adj(dat, trend = T, seas = F, trend_method = "firstdiff")
g_dat <- ser_adj(g_dat, trend = T, seas = F, trend_method = "firstdiff")
plot(dat$time, dat$value, type = "l")
plot(g_dat$time, g_dat$value, type = "l")
plot(dat$time, dat$value, type = "l")
plot(g_dat$time, g_dat$value, type = "l")
str(final(sa))
ts_tbl(final(sa))
AirPassengers
seas(ts_tbl(final(sa)))
seas(tbl_ts(final(sa)))
ts_tbl(final(sa))
ts(ts_tbl(final(sa)))
?ts
as.ts(ts_tbl(final(sa)))
as.ts(ts_tbl(final(sa)), start = (1970,1), frequency = 12)
ts(ts_tbl(final(sa)), start = (1970,1), frequency = 12)
ts(ts_tbl(final(sa)), start = c(1970,1), frequency = 12)
