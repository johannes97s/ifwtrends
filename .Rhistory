mutate(m = mean(value)) %>%
left_join(mutate(s, orig = value))
s
t %>% mutate(time = floor_date(time, "month")) %>%
group_by(time) %>%
mutate(m = mean(value)) %>%
left_join(mutate(s, orig = value), by = "time")
t2 <- t %>% mutate(time = floor_date(time, "month")) %>%
group_by(time) %>%
mutate(m = mean(value)) %>%
left_join(mutate(s, orig = value, keep = "used"), by = "time")
t %>% mutate(time = floor_date(time, "month")) %>%
group_by(time) %>%
mutate(m = mean(value)) %>%
left_join(mutate(s, orig = value, keep = "used"), by = "time")
t %>% mutate(time = floor_date(time, "month")) %>%
group_by(time) %>%
mutate(m = mean(value))
s
t %>% mutate(time = floor_date(time, "month")) %>%
group_by(time) %>%
mutate(m = mean(value))
t2 <- t %>% mutate(time = floor_date(time, "month")) %>%
group_by(time) %>%
mutate(m = mean(value))
plot(select(t2, time, m), t ="l")
linex(s)
lines(s)
s<-ts_gtrends(keyword = "arbeitslos", geo = "DE", time = "2006-01-01 2021-10-05")
plot(select(t2, time, m), t ="l")
lines(s, col = "r")
lines(s, col = "red")
s
print(t2, n = 300)
s
tail(s)
tail(t2)
path("..")
path.expand("..")
path.expand("...")
path.expand(".")
path.expand(.)
path.expand("~")
?caret
library(devtools)
use_package("rJava")
load_all()
check()
x13(AirPassengers)
path.expand("~")
Sys.setenv(JAVA_HOME = "~/Java/jre-8"
)
Sys.setenv(JAVA_HOME = "~/Java/jre-8")
check()
JAVA_HOME
Sys.getenv("JAVA_HOME")
load_all()
check()
library(rJava)
check()
check()
library(rJava)
Sys.getenv("Path")
check()
load_all()
check()
document()
#' @importFrom dplyr mutate
#' @importFrom dplyr select
#' @importFrom dplyr filter
#' @importFrom tidyr pivot_longer
#' @importFrom openxlsx write.xlsx
#' @importFrom readxl read_excel
#' @importFrom stats poly
#' @importFrom rlang !!
#' @importFrom rlang :=
#' @export
est_trends <- function(){
end = Sys.Date
dates <- seq.Date(
from = as.Date( "2006-01-01"),
to = as.Date(end),
by = "month"
)
series <- tibble(date = dates)
missing = NULL
cat_samp <- unique(c(sample(categories$id, 280), "67")) #67 is arbitrary chosen
k = 0
for (i in cat_samp){
Sys.sleep(0.1)
g <- gtrends(
geo = "DE",
time = str_c("2006-01-01 ", end),
category = i
)$interest_over_time
if (is.null(g)) {
missing <- c(missing, i)
} else {
series <- bind_cols(series, !!as.character(eval(i)) := g$hits)
}
k <- k+1
print(k)
}
series <- series %>%
pivot_longer( cols = -date, names_to = "id", values_to = "value") %>%
mutate(value = log(value))
write.xlsx(series, "data/cat_sample_Q32021.xlsx")
series <- read_excel("data/cat_sample_Q42019.xlsx")
series<-arrange(series, id)
fit <- lm(value ~ id -1 +poly(as.numeric(date), 5, raw = T), data = series)
series <- mutate(series, date = as.Date(date), fit = fit)
series
}
load_all()
@export
#' @importFrom dplyr mutate
#' @importFrom dplyr select
#' @importFrom dplyr filter
#' @importFrom tidyr pivot_longer
#' @importFrom openxlsx write.xlsx
#' @importFrom readxl read_excel
#' @importFrom stats poly
#' @importFrom rlang !!
#' @importFrom rlang :=
#' @export
est_trend <- function(){
end = Sys.Date
dates <- seq.Date(
from = as.Date( "2006-01-01"),
to = as.Date(Sys.Date()),
by = "month"
)
series <- tibble(date = dates)
missing = NULL
cat_samp <- unique(c(sample(categories$id, 280), "67")) #67 is arbitrary chosen
k = 0
for (i in cat_samp){
Sys.sleep(0.1)
g <- gtrends(
geo = "DE",
time = str_c("2006-01-01 ", end),
category = i
)$interest_over_time
if (is.null(g)) {
missing <- c(missing, i)
} else {
series <- bind_cols(series, !!as.character(eval(i)) := g$hits)
}
k <- k+1
print(k)
}
series <- series %>%
pivot_longer( cols = -date, names_to = "id", values_to = "value") %>%
mutate(value = log(value))
write.xlsx(series, "data/cat_sample_Q32021.xlsx")
series <- read_excel("data/cat_sample_Q42019.xlsx")
series<-arrange(series, id)
fit <- lm(value ~ id -1 +poly(as.numeric(date), 5, raw = T), data = series)
series <- mutate(series, date = as.Date(date), fit = fit)
series
}
load_all()
trendecon::categories
gtrendsR::categories
#' @importFrom dplyr mutate
#' @importFrom dplyr select
#' @importFrom dplyr filter
#' @importFrom tidyr pivot_longer
#' @importFrom openxlsx write.xlsx
#' @importFrom readxl read_excel
#' @importFrom stats poly
#' @importFrom rlang !!
#' @importFrom rlang :=
#' @export
est_trend <- function(){
end = Sys.Date
dates <- seq.Date(
from = as.Date( "2006-01-01"),
to = as.Date(Sys.Date()),
by = "month"
)
series <- tibble(date = dates)
missing = NULL
cat_samp <- unique(c(sample(categories$id, 280), "67")) #67 is arbitrary chosen
k = 0
for (i in cat_samp){
Sys.sleep(0.1)
g <- gtrends(
geo = "DE",
time = str_c("2006-01-01 ", end),
category = i
)$interest_over_time
if (is.null(g)) {
missing <- c(missing, i)
} else {
series <- bind_cols(series, !!as.character(eval(i)) := g$hits)
}
k <- k+1
print(k)
}
series <- series %>%
pivot_longer( cols = -date, names_to = "id", values_to = "value") %>%
mutate(value = log(value))
write.xlsx(series, "data/cat_sample_Q32021.xlsx")
series <- read_excel("data/cat_sample_Q42019.xlsx")
series<-arrange(series, id)
fit <- lm(value ~ id -1 +poly(as.numeric(date), 5, raw = T), data = series)
series <- mutate(series, date = as.Date(date), fit = fit)
series
}
load_all()
rm(list = c("est_trend"))
load_all()
document()
document()
document()
load_all()
document()
check()
rm(est_trends())
rm("est_trends()")
rm("est_trends")
est_trend()
load_all()
load_all()
load_all()
est_trend()
install()
load_all()
library(devtools)
load_all()
install.packages("rJava")
load_all()
install.packages("RJDemetra")
library(devtools)
install()
Sys.getenv(JAVA_HOME)
Sys.setenv(JAVA_HOME = "C:\\Program Files\\OpenJDK\\jre-8.0.292.10-hotspot")
install()
Sys.getenv("JAVA_HOME")
library(rJava)
Sys.setenv(JAVA_HOME = "C:/Program Files/OpenJDK/jre-8.0.262.10-hotspot")
library(rJava)
install()
library(devtools)
install()
load_all()
document()
document()
load_all()
install()
library(ifwtrends)
load_all()
library(devtools)
load_all()
document()
library(rJava)
Sys.getenv("R_ENVIRON_USER")
path.expand("./.Renviron")
getwd()
usethis::edit_r_environ()
usethis::edit_r_environ("ifwtrends")
usethis::edit_r_environ(project = "ifwtrends")
usethis::edit_r_environ("ifwtrends")
usethis::edit_r_environ("project")
Sys.getenv(JAVA_HOME)
load_all()
library(devtools)
load_all()
library(devtools)
load_all()
Sys.getenv(JAVA_HOME)
install()
library(ifwtrends)
load_all()
document()
load_all
load_all()
install()
library(ifwtrends)
est_trend
est_trend()
library(ifwtrends)
est_trend()
est_trend()
#' @importFrom dplyr mutate
#' @importFrom dplyr select
#' @importFrom dplyr filter
#' @importFrom tidyr pivot_longer
#' @importFrom openxlsx write.xlsx
#' @importFrom readxl read_excel
#' @importFrom stats poly
#' @importFrom rlang !!
#' @importFrom rlang :=
#' @export
est_trend <- function(){
end = Sys.Date()
dates <- seq.Date(
from = as.Date( "2006-01-01"),
to = end,
by = "month"
)
series <- tibble(date = dates)
missing = NULL
cat_samp <- unique(c(sample(gtrendsR::categories$id, 280), "67")) #67 is arbitrary chosen
k = 0
for (i in cat_samp){
Sys.sleep(0.1)
g <- gtrends(
geo = "DE",
time = str_c("2006-01-01 ", end),
category = i
)$interest_over_time
if (is.null(g)) {
missing <- c(missing, i)
} else {
series <- bind_cols(series, !!as.character(eval(i)) := g$hits)
}
k <- k+1
print(k)
}
series <- series %>%
pivot_longer( cols = -date, names_to = "id", values_to = "value") %>%
mutate(value = log(value)) %>%
arrange(id)
saveRDS(series, "data/cat_sample.rds")
fit <- lm(value ~ id -1 +poly(as.numeric(date), 5, raw = T), data = series)
series <- mutate(series, date = as.Date(date), fit = fit)
series
}
est_trend()
library(tidyverse)
est_trend()
library(gtrendsR)
est_trend()
cat_samp <- unique(c(sample(gtrendsR::categories$id, 280), "67"))
cat_samp
lm(1~2)
lm(c(1,2,3)~c(2,3,4))
lm(c(1,2,3)~c(2,3,4))$fitted_values
summary(lm(c(1,2,3)~c(2,3,4)))$fitted_values
summary(lm(c(1,2,3)~c(2,3,4)))
lm(c(1,2,3)~c(2,3,4))
.Last.value$fitted.values
lm(c(1,2,3)~c(2,7,4))
.Last.value$fitted.values
.Last.value$fitted.values[[1]]
v <- lm(c(1,2,3)~c(2,7,4))$fitted.values
v$1
v
v[[1]]
v[1]
str(v)
unname(v)
#' @importFrom dplyr mutate
#' @importFrom dplyr select
#' @importFrom dplyr filter
#' @importFrom tidyr pivot_longer
#' @importFrom openxlsx write.xlsx
#' @importFrom readxl read_excel
#' @importFrom stats poly
#' @importFrom rlang !!
#' @importFrom rlang :=
#' @export
est_trend <- function(){
end = Sys.Date()
dates <- seq.Date(
from = as.Date( "2006-01-01"),
to = end,
by = "month"
)
series <- tibble(date = dates)
missing = NULL
cat_samp <- unique(c(sample(gtrendsR::categories$id, 20), "67")) #67 is arbitrary chosen
k = 0
for (i in cat_samp){
Sys.sleep(0.1)
g <- gtrends(
geo = "DE",
time = str_c("2006-01-01 ", end),
category = i
)$interest_over_time
if (is.null(g)) {
missing <- c(missing, i)
} else {
series <- bind_cols(series, !!as.character(eval(i)) := g$hits)
}
k <- k+1
print(k)
}
series <- series %>%
pivot_longer( cols = -date, names_to = "id", values_to = "value") %>%
mutate(value = log(value)) %>%
arrange(id)
saveRDS(series, "data/cat_sample.rds")
fit <- unname(lm(value ~ id -1 +poly(as.numeric(date), 5, raw = T), data = series)$fitted.values)
series <- mutate(series, fit = fit)
series
}
est_trend()
plot(select(.Last.value, date, fit))
#' @importFrom dplyr mutate
#' @importFrom dplyr select
#' @importFrom dplyr filter
#' @importFrom tidyr pivot_longer
#' @importFrom openxlsx write.xlsx
#' @importFrom readxl read_excel
#' @importFrom stats poly
#' @importFrom rlang !!
#' @importFrom rlang :=
#' @export
est_trend <- function(){
end = Sys.Date()
dates <- seq.Date(
from = as.Date( "2006-01-01"),
to = end,
by = "month"
)
series <- tibble(date = dates)
missing = NULL
cat_samp <- unique(c(sample(gtrendsR::categories$id, 20), "67")) #67 is arbitrary chosen
k = 0
for (i in cat_samp){
Sys.sleep(0.1)
g <- gtrends(
geo = "DE",
time = str_c("2006-01-01 ", end),
category = i
)$interest_over_time
if (is.null(g)) {
missing <- c(missing, i)
} else {
series <- bind_cols(series, !!as.character(eval(i)) := g$hits)
}
k <- k+1
print(k)
}
series <- series %>%
pivot_longer( cols = -date, names_to = "id", values_to = "value") %>%
mutate(value = log(value)) %>%
arrange(id)
saveRDS(series, "data/cat_sample.rds")
fit <- unname(lm(value ~ id -1 +poly(as.numeric(date), 5, raw = T), data = series)$fitted.values)
comtrend <- series %>%
mutate(trend = fit) %>%
filter(id == 67) %>%
select(date, trend)
saveRDS(comtrend, "data/comtrend.rds")
series
}
#' @importFrom dplyr mutate
#' @importFrom dplyr select
#' @importFrom dplyr filter
#' @importFrom tidyr pivot_longer
#' @importFrom openxlsx write.xlsx
#' @importFrom readxl read_excel
#' @importFrom stats poly
#' @importFrom rlang !!
#' @importFrom rlang :=
#' @export
est_trend <- function(){
end = Sys.Date()
dates <- seq.Date(
from = as.Date( "2006-01-01"),
to = end,
by = "month"
)
series <- tibble(date = dates)
missing = NULL
cat_samp <- unique(c(sample(gtrendsR::categories$id, 20), "67")) #67 is arbitrary chosen
k = 0
for (i in cat_samp){
Sys.sleep(0.1)
g <- gtrends(
geo = "DE",
time = str_c("2006-01-01 ", end),
category = i
)$interest_over_time
if (is.null(g)) {
missing <- c(missing, i)
} else {
series <- bind_cols(series, !!as.character(eval(i)) := g$hits)
}
k <- k+1
print(k)
}
series <- series %>%
pivot_longer( cols = -date, names_to = "id", values_to = "value") %>%
mutate(value = log(value)) %>%
arrange(id)
saveRDS(series, "data/cat_sample.rds")
fit <- unname(lm(value ~ id -1 +poly(as.numeric(date), 5, raw = T), data = series)$fitted.values)
comtrend <- series %>%
mutate(trend = fit) %>%
filter(id == 67) %>%
select(date, trend)
saveRDS(comtrend, "data/comtrend.rds")
series
}
est_trend()
readRDS("data/comtrend.rds")
plot(.Last.value)
load_all()
install()
library(ifwtrends)
Sys.setenv(JAVA_HOME = "C:/Program Files/OpenJDK/jre-8.0.292.10-hotspot)
)
Sys.setenv(JAVA_HOME = "C:/Program Files/OpenJDK/jre-8.0.292.10-hotspot")
install()
library(rJava)
library(RJDemetra)
install()
